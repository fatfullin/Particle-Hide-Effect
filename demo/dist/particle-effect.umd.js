(function(n,s){typeof exports=="object"&&typeof module<"u"?module.exports=s():typeof define=="function"&&define.amd?define(s):(n=typeof globalThis<"u"?globalThis:n||self,n.ParticleEffect=s())})(this,function(){"use strict";var u=Object.defineProperty;var g=(n,s,r)=>s in n?u(n,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[s]=r;var m=(n,s,r)=>g(n,typeof s!="symbol"?s+"":s,r);class n{constructor(t,e,i){this.canvas=t,this.ctx=e,this.settings=i,this.reset(!0)}reset(t=!1){const e=Math.max(0,this.canvas.width-2*this.settings.particleSpawnMargin),i=Math.max(0,this.canvas.height-2*this.settings.particleSpawnMargin);this.x=this.settings.particleSpawnMargin+Math.random()*e,this.y=this.settings.particleSpawnMargin+Math.random()*i,this.x=Math.max(0,Math.min(this.x,this.canvas.width)),this.y=Math.max(0,Math.min(this.y,this.canvas.height)),this.radius=Math.random()*(this.settings.maxRadius-this.settings.minRadius)+this.settings.minRadius;const a=Math.random()*Math.PI*2,h=Math.random()*(this.settings.maxSpeed-this.settings.minSpeed)+this.settings.minSpeed;this.vx=Math.cos(a)*h,this.vy=Math.sin(a)*h,Math.random()<this.settings.blackRatioPercent/100?this.initialOpacity=1:this.initialOpacity=Math.random()*(this.settings.maxSemiTransparentOpacity-this.settings.minSemiTransparentOpacity)+this.settings.minSemiTransparentOpacity,this.lifetimeSeconds=Math.random()*(this.settings.maxLifetimeSeconds-this.settings.minLifetimeSeconds)+this.settings.minLifetimeSeconds,t?(this.ageSeconds=Math.random()*this.lifetimeSeconds,this.calculateCurrentOpacity()):(this.ageSeconds=0,this.currentOpacity=0)}calculateCurrentOpacity(){const t=this.settings.fadeInDurationSeconds,e=Math.max(t,this.lifetimeSeconds-this.settings.fadeOutDurationSeconds);if(this.ageSeconds<t){const i=Math.max(.001,t),a=Math.max(0,Math.min(1,this.ageSeconds/i));this.currentOpacity=this.initialOpacity*a}else if(this.ageSeconds<e)this.currentOpacity=this.initialOpacity;else{const i=Math.max(.001,this.settings.fadeOutDurationSeconds),a=this.ageSeconds-e,h=Math.min(1,a/i);this.currentOpacity=this.initialOpacity*(1-h)}this.currentOpacity=Math.max(0,Math.min(this.initialOpacity,this.currentOpacity))}update(t){if(this.ageSeconds+=t,this.ageSeconds>=this.lifetimeSeconds){this.reset(!1);return}this.x+=this.vx,this.y+=this.vy,this.calculateCurrentOpacity(),this.currentOpacity>0&&(this.x+this.radius<0||this.x-this.radius>this.canvas.width||this.y+this.radius<0||this.y-this.radius>this.canvas.height)&&this.reset(!1)}draw(){if(this.currentOpacity<=0)return;this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);let t=Math.max(0,Math.min(1,this.currentOpacity));const i=Math.min(this.canvas.width,this.canvas.height)*(this.settings.edgeFadePercent/100),a=Math.min(this.x,this.canvas.width-this.x),h=Math.min(this.y,this.canvas.height-this.y),c=Math.min(a,h);let o=1;if(i>0&&c<i){const d=Math.max(0,Math.min(1,c/i));o=d*d}const l=Math.max(0,Math.min(1,t*o));if(l<=0)return;const f=this.settings.particleColor.substring(this.settings.particleColor.indexOf("(")+1,this.settings.particleColor.lastIndexOf(",")).trim();this.ctx.fillStyle=`rgba(${f}, ${l})`,this.ctx.fill()}}const r=class r{constructor(t,e={}){if(!t||!(t instanceof Element)){console.error("ParticleEffect: targetElement is not a valid DOM Element.");return}this.targetElement=t,this.config={...r.defaultConfig,...e},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.targetElement.style.position="relative",this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.pointerEvents="none",this.targetElement.appendChild(this.canvas),this.particles=[],this.animationFrameId=null,this.lastTimestamp=0,this.isActive=!1,this.isDestroyed=!1,this._animate=this._animate.bind(this),this._resizeCanvas=this._resizeCanvas.bind(this),this.resizeObserver=new ResizeObserver(i=>{for(let a of i)this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(this._resizeCanvas,50)}),this.resizeObserver.observe(this.targetElement),this._resizeCanvas(),this.config.autoStart&&this.start()}_resizeCanvas(){this.isDestroyed||(this.canvas.width=this.targetElement.offsetWidth,this.canvas.height=this.targetElement.offsetHeight,this.isActive&&this._createParticles())}_createParticles(){if(this.isDestroyed||this.canvas.width===0||this.canvas.height===0){this.particles=[];return}const t=this.canvas.width*this.canvas.height,e=this.config.particleDensity/1e4,i=Math.round(t*e),a=Math.max(10,Math.min(i,3e3));this.particles=[];for(let h=0;h<a;h++)this.particles.push(new n(this.canvas,this.ctx,this.config))}_animate(t){if(!this.isActive||this.isDestroyed){this.animationFrameId=null;return}const e=(t-(this.lastTimestamp||t))/1e3;this.lastTimestamp=t;const i=.05,a=e<=0?1/60:e,h=Math.min(a,i);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.particles.forEach(c=>{c.update(h),c.draw()}),this.animationFrameId=requestAnimationFrame(this._animate)}start(){this.isActive||this.isDestroyed||(this.isActive=!0,console.log("ParticleEffect: Starting animation"),this._resizeCanvas(),this.animationFrameId||(this.lastTimestamp=performance.now(),this.animationFrameId=requestAnimationFrame(this._animate)))}stop(){!this.isActive||this.isDestroyed||(this.isActive=!1,console.log("ParticleEffect: Stopping animation"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.ctx&&this.canvas&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height))}toggle(){this.isDestroyed||(this.isActive?this.stop():this.start())}updateConfig(t){this.isDestroyed||!t||(this.config={...r.defaultConfig,...this.config,...t},console.log("ParticleEffect: Config updated",this.config),this.isActive?this._createParticles():this.particles=[])}destroy(){this.isDestroyed||(console.log("ParticleEffect: Destroying instance"),this.isDestroyed=!0,this.stop(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this._resizeTimeout&&clearTimeout(this._resizeTimeout),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.particles=[],this.canvas=null,this.ctx=null,this.targetElement=null,this.config=null)}};m(r,"defaultConfig",{particleDensity:150,particleColor:"rgba(30, 30, 30, 0.7)",minSpeed:.15,maxSpeed:.5,minRadius:.5,maxRadius:1.2,particleSpawnMargin:10,edgeFadePercent:15,minLifetimeSeconds:1.5,maxLifetimeSeconds:4,fadeOutDurationSeconds:.5,fadeInDurationSeconds:.5,blackRatioPercent:50,minSemiTransparentOpacity:.2,maxSemiTransparentOpacity:.7,autoStart:!0});let s=r;return s});
